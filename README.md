# Credential Swift

This package is for providing sensitive credential information for app to use.
You may use `credential-swift` as a command line tool to encrypt credential data into encrypted binary as a file or code.


## Disclaimer 

This solution is not intended for security professionals, the goal of this solution is to provide a way to relatively secure to deal with sensitive credential information such as API key, shared secret, password and some others from causal hackers.

## Encrypt to file

Encrypt file into encrypted binary file with 32 byte encryption key, 64 hexadecimal characters. 
The encrypted file can be decoded by AES256GCM.swift provided by this package.  Encrypted file can be embed to app, or placed on server side, and can be used upon download.

```.console
$ credential-swift encrypt -in credentials.plist -out credentials.bin -key {hexadecimal_32byte_key}
```

Remember, it requires the encryption key when decrypting that credential information.

```
let encryptionKey = ...
let encryptedCredentialData: Data = ...
let credentialData = try? encryptedCredentialData.decrypt_AES256GCM(with: encryptionKey)
```


## Encrypt to code

Downside of file based encryption is that there may be a change to expose encrypted file in your app resources.  Although it is encrypted but you may not expose resource file like `credentials.enc` in your app resource.  Similarly, when you download credential data as a temporary file somewhere in you local storage, although they are encrypted you may not willing to expose its filename which is easy to guess.  You may spend time for providing some trick for this, but here is an another choice.

credential-swift provides a way to generate swift code to use in you app directory, so you sensitive credential information are not exposed directory on your app resources.

```
$ credential-swift encrypt -in credentials.plist -source credentials.swift -key {hexadecimal_32byte_key}
```

This is an example of swift code generated by credential-swift.  As you noticed, it provides encrypted credentials data by code. And it provide decryption swift code with it including encryption key by swift code.

```credentials.swift
//...snip...
import Foundation
import CryptoKit
fileprivate extension Data {
	func encrypt_AES256GCM(with key: Data) throws -> Data {
		let nonce = AES.GCM.Nonce()
		let sealedBox = try AES.GCM.seal(self, using: SymmetricKey(data: key), nonce: nonce)
		return sealedBox.combined!
	}
	
	func decrypt_AES256GCM(with key: Data) throws -> Data {
		let sealedBox = try AES.GCM.SealedBox(combined: self)
		let decryptedData = try AES.GCM.open(sealedBox, using: SymmetricKey(data: key))
		return decryptedData
	}
}
extension Data {
	static var credentials: Data? = {
		let key = Data([0x3a,0xe7,/*...snip...*/,0x54,0x9f,0x7b])
		return try? Data([
			0xca,0x71,0x1c,0xd9,0x1b,0x50,0xac,0x69,0xba,0xb7,0xdf,0xae,0x84,0x68,0xc9,0x5f,
			0x33,0xdf,0x05,0xfe,0xc9,0x7d,0xa4,0xec,0x8d,0xb7,0x83,0x2b,0x48,0x08,0xd9,0xc2,
			//...snip...
			0x75,0x60,0xff,0x4c,0xa8,0x51,0x08,0x2b,0x19
		]).decrypt_AES256GCM(with: key)
	}()
}			

```

So, you can add this swift source file into your Xcode project and use credential data without decryption explicitly from from your code.


```swift
	if let data = Data.credentials,
	   let dictionary = try? PropertyListSerialization.propertyList(from: data, format: nil) as? NSDictionary,
	   let apiKey = dictionary["API_KEY"] as? String,
	   let secretKey = dictionary["SECRET_KEY"] as? String {
		// ...
	}
	else {
		// something went wrong
	}
```

Remember, `-source` option specifies the location of source code, but source file name is used for swift's identifier, for example `-source ~/Desktop/foo.swift` generates `Data.foo`, so make sure identifier will not collide within your project.

```
extension Data {
	static var foo: Data? = {
		//...snip...
	}
}
```

You may omit key if you only generate source, an appropriate encryption key are generated and used for its source code, but if you specify `out` option to specify encrypted file, then you must specify encryption key as an argument, or encrypted data lost the way to decrypt back.

## Decrypt from file

You can decrypt encrypted file from command line.  You must specify proper encryption key to decrypt from file.

```
$ credential-swift decrypt -in credentials.enc -out credentials.plist -key {hexadecimal_32byte_key}
```

## Generating 32 byte random encryption key

In case you need to generate random 32 byte key for encryption key, you may use `openssl` to do this as follows. 

```console
$ openssl rand -hex 32
9d67bd41afb4c2f9af8361928b2a6379c8969760eb711d401415a7a1f2268a72
```

## Status

I think it is not ready for productions, but should be ready for testing.

## Thanks

Thanks to Chat GPT and GPT 4 for giving me some advices.

